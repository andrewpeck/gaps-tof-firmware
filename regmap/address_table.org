#+OPTIONS: toc:5
#+OPTIONS: ^:nil

# START: ADDRESS_TABLE_VERSION :: DO NOT EDIT
# END: ADDRESS_TABLE_VERSION :: DO NOT EDIT

# START: ADDRESS_TABLE :: DO NOT EDIT

* Module DRS 	 adr = ~0x0~

Implements various control and monitoring functions of the DRS Logic

*DRS.CHIP*

Registers for configuring the DRS ASIC Directly

|------------------+-------+-----------+------+--------+--------------------------------------------|
| Node             | Adr   | Bits      | Perm | Def    | Description                                |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| DMODE            | ~0x0~ | ~1~       | rw   | ~0x1~  | set 1 = continuous domino, 0=single shot   |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| STANDBY_MODE     | ~0x0~ | ~2~       | rw   | ~0x0~  | set 1 = shutdown drs                       |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| TRANSPARENT_MODE | ~0x0~ | ~3~       | rw   | ~0x0~  | set 1 = transparent mode                   |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| DRS_PLL_LOCK     | ~0x0~ | ~4~       | r    |        | DRS PLL Locked                             |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| CHANNEL_CONFIG   | ~0x0~ | ~[31:24]~ | rw   | ~0xFF~ | Write Shift Register Configuration         |
|                  |       |           |      |        | # of chn - # of cells per ch - bit pattern |
|                  |       |           |      |        | 8        - 1024              - 11111111b   |
|                  |       |           |      |        | 4        - 2048              - 01010101b   |
|                  |       |           |      |        | 2        - 4096              - 00010001b   |
|                  |       |           |      |        | 1        - 8192              - 00000001b   |
|------------------+-------+-----------+------+--------+--------------------------------------------|
| DTAP_FREQ        | ~0x1~ | ~[31:0]~  | r    |        | Frequency of DTAP in MHz                   |
|------------------+-------+-----------+------+--------+--------------------------------------------|

*DRS.READOUT*

Registers for configuring the readout state machine

|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| Node             | Adr    | Bits      | Perm | Def      | Description                                                                                              |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| ROI_MODE         | ~0x10~ | ~0~       | rw   | ~0x1~    | Set to 1 to enable Region of Interest Readout                                                            |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| BUSY             | ~0x10~ | ~1~       | r    |          | DRS is busy                                                                                              |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| ADC_LATENCY      | ~0x10~ | ~[9:4]~   | rw   | ~0x0~    | Latency from first sr clock to when ADC data should be valid                                             |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| SAMPLE_COUNT     | ~0x10~ | ~[21:12]~ | rw   | ~0x3FF~  | Number of samples to read out (0 to 1023)                                                                |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| EN_SPIKE_REMOVAL | ~0x10~ | ~22~      | rw   | ~0x1~    | set 1 to enable spike removal                                                                            |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| READOUT_MASK     | ~0x11~ | ~[8:0]~   | rw   | ~0x1FF~  | 8 bit mask, set a bit to 1 to enable readout of that channel. 9th is auto-read if any channel is enabled |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| AUTO_9TH_CHANNEL | ~0x11~ | ~9~       | rw   | ~0x1~    | Set to 1 to auto read the 9th channel                                                                    |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| START            | ~0x12~ | ~0~       | w    | Pulse    | Write 1 to take the state machine out of idle mode                                                       |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| REINIT           | ~0x13~ | ~0~       | w    | Pulse    | Write 1 to reinitialize DRS state machine (restores to idle state)                                       |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| CONFIGURE        | ~0x14~ | ~0~       | w    | Pulse    | Write 1 to configure the DRS. Should be done before data taking                                          |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| DRS_RESET        | ~0x15~ | ~0~       | w    | Pulse    | Write 1 to completely reset the DRS state machine logic                                                  |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| DAQ_RESET        | ~0x16~ | ~0~       | w    | Pulse    | Write 1 to completely reset the DAQ state machine logic                                                  |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| DMA_RESET        | ~0x17~ | ~0~       | w    | Pulse    | Write 1 to completely reset the DMA state machine logic                                                  |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|
| WAIT_VDD_CLKS    | ~0x18~ | ~[15:0]~  | rw   | ~0x4000~ | Number of 30 ns clocks to wait before reading out the drs, allowing vdd to stabilize                     |
|------------------+--------+-----------+------+----------+----------------------------------------------------------------------------------------------------------|

*DRS.FPGA.DNA*

FPGA Device DNA

|----------+--------+----------+------+-----+--------------------|
| Node     | Adr    | Bits     | Perm | Def | Description        |
|----------+--------+----------+------+-----+--------------------|
| DNA_LSBS | ~0x20~ | ~[31:0]~ | r    |     | Device DNA [31:0]  |
|----------+--------+----------+------+-----+--------------------|
| DNA_MSBS | ~0x21~ | ~[24:0]~ | r    |     | Device DNA [56:32] |
|----------+--------+----------+------+-----+--------------------|

*DRS.FPGA.TIMESTAMP*

Timestamp

|----------------+--------+----------+------+-----+--------------------------|
| Node           | Adr    | Bits     | Perm | Def | Description              |
|----------------+--------+----------+------+-----+--------------------------|
| TIMESTAMP_LSBS | ~0x24~ | ~[31:0]~ | r    |     | Device TIMESTAMP [31:0]  |
|----------------+--------+----------+------+-----+--------------------------|
| TIMESTAMP_MSBS | ~0x25~ | ~[15:0]~ | r    |     | Device TIMESTAMP [47:32] |
|----------------+--------+----------+------+-----+--------------------------|

*DRS.DAQ*

DAQ

|---------------------+--------+------+------+-------+--------------------------------------------------|
| Node                | Adr    | Bits | Perm | Def   | Description                                      |
|---------------------+--------+------+------+-------+--------------------------------------------------|
| INJECT_DEBUG_PACKET | ~0x30~ | ~0~  | w    | Pulse | Injects a fixed format debug packet into the DAQ |
|---------------------+--------+------+------+-------+--------------------------------------------------|

*DRS.TRIGGER*

Trigger

|-----------------------+--------+------+------+-------+-----------------------------------------|
| Node                  | Adr    | Bits | Perm | Def   | Description                             |
|-----------------------+--------+------+------+-------+-----------------------------------------|
| FORCE_TRIGGER         | ~0x40~ | ~0~  | w    | Pulse | Generates a trigger                     |
|-----------------------+--------+------+------+-------+-----------------------------------------|
| EXT_TRIGGER_EN        | ~0x41~ | ~0~  | rw   | ~0x1~ | Set to 1 to enable the external trigger |
|-----------------------+--------+------+------+-------+-----------------------------------------|
| EXT_TRIGGER_ACTIVE_HI | ~0x41~ | ~1~  | rw   | ~0x1~ | Generates a trigger                     |
|-----------------------+--------+------+------+-------+-----------------------------------------|

*DRS.COUNTERS*

Counters

|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| Node                       | Adr    | Bits      | Perm | Def | Description                                                        |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_SEM_CORRECTION         | ~0x50~ | ~[15:0]~  | r    |     | Number of Single Event Errors corrected by the scrubber            |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_SEM_UNCORRECTABLE      | ~0x51~ | ~[19:16]~ | r    |     | Number of Critical Single Event Errors (uncorrectable by scrubber) |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_READOUTS_COMPLETED     | ~0x52~ | ~[31:0]~  | r    |     | Number of readouts completed since reset                           |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_DMA_READOUTS_COMPLETED | ~0x53~ | ~[31:0]~  | r    |     | Number of readouts completed since reset                           |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_LOST_EVENT             | ~0x54~ | ~[31:16]~ | r    |     | Number of trigger lost due to deadtime                             |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|
| CNT_EVENT                  | ~0x55~ | ~[31:0]~  | r    |     | Number of triggers received                                        |
|----------------------------+--------+-----------+------+-----+--------------------------------------------------------------------|

*DRS.HOG*

HOG Parameters

|-------------+--------+----------+------+-----+--------------------|
| Node        | Adr    | Bits     | Perm | Def | Description        |
|-------------+--------+----------+------+-----+--------------------|
| GLOBAL_DATE | ~0x60~ | ~[31:0]~ | r    |     | HOG Global Date    |
|-------------+--------+----------+------+-----+--------------------|
| GLOBAL_TIME | ~0x61~ | ~[31:0]~ | r    |     | HOG Global Time    |
|-------------+--------+----------+------+-----+--------------------|
| GLOBAL_VER  | ~0x62~ | ~[31:0]~ | r    |     | HOG Global Version |
|-------------+--------+----------+------+-----+--------------------|
| GLOBAL_SHA  | ~0x63~ | ~[31:0]~ | r    |     | HOG Global SHA     |
|-------------+--------+----------+------+-----+--------------------|
| TOP_SHA     | ~0x64~ | ~[31:0]~ | r    |     | HOG Top SHA        |
|-------------+--------+----------+------+-----+--------------------|
| TOP_VER     | ~0x65~ | ~[31:0]~ | r    |     | HOG Top Version    |
|-------------+--------+----------+------+-----+--------------------|
| HOG_SHA     | ~0x66~ | ~[31:0]~ | r    |     | HOG SHA            |
|-------------+--------+----------+------+-----+--------------------|
| HOG_VER     | ~0x67~ | ~[31:0]~ | r    |     | HOG Version        |
|-------------+--------+----------+------+-----+--------------------|

*DRS.SPY*

Spy Buffer

|-------+--------+----------+------+-------+------------------|
| Node  | Adr    | Bits     | Perm | Def   | Description      |
|-------+--------+----------+------+-------+------------------|
| RESET | ~0x70~ | ~0~      | w    | Pulse | Spy Buffer Reset |
|-------+--------+----------+------+-------+------------------|
| DATA  | ~0x71~ | ~[15:0]~ | r    |       | Spy Read Data    |
|-------+--------+----------+------+-------+------------------|
| FULL  | ~0x72~ | ~0~      | r    |       | Spy Buffer Full  |
|-------+--------+----------+------+-------+------------------|
| EMPTY | ~0x72~ | ~1~      | r    |       | Spy Buffer Empty |
|-------+--------+----------+------+-------+------------------|

# END: ADDRESS_TABLE :: DO NOT EDIT
